<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Height Comparison</title>
    <style>
        /* input#characters {} */
        div#canvas {
            display: flex;
            flex-direction: row;
            div.container {
                position: relative;
                img {
                    max-height: 500px;
                }
                fieldset {
                    display: flex;
                    flex-direction: column;
                }
                div.height-indicator {
                    position: absolute;
                    left: 0;
                    right: 0;
                    border: 1px solid red;
                }
            }
        }
    </style>
</head>
<body>
    <input type="file" id="characters" accept="image/png, image/jpeg" multiple>
    <div id="canvas"></div>
    <script>
        /** @type HTMLInputElement */
        const characters = document.getElementById("characters");
        /** @type HTMLDivElement */
        const canvas = document.getElementById("canvas");

        characters.addEventListener('change', (e) => {
            let files = characters.files;
            if (files === null) {
                for (const child of canvas) {
                    child.remove();
                }
            } else {
                while (canvas.childElementCount > 0) {
                    canvas.children.item(0).remove();
                }
                for (const file of files) {
                    const container = document.createElement('div');
                    container.classList.add("container");
                    canvas.appendChild(container);

                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    container.appendChild(img);

                    const heightIndicator = document.createElement('div');
                    heightIndicator.classList.add("height-indicator");
                    container.appendChild(heightIndicator);

                    img.onload = () => {
                        const imgHeight = img.naturalHeight;

                        const fieldset = document.createElement('fieldset');

                        const topSlider = document.createElement('input');
                        topSlider.type = "range";
                        topSlider.min = 0.0;
                        topSlider.max = imgHeight;
                        topSlider.value = imgHeight;
                        fieldset.appendChild(topSlider);

                        const botSlider = document.createElement('input');
                        botSlider.type = "range";
                        botSlider.min = 0.0;
                        botSlider.max = imgHeight;
                        botSlider.value = 0.0;
                        fieldset.appendChild(botSlider);

                        container.appendChild(fieldset);

                        const updateHeight = (e) => {
                            botSlider.value = Math.min(botSlider.value, topSlider.value);
                            let scale = img.clientHeight / imgHeight;
                            heightIndicator.style.top = `${(imgHeight - topSlider.value)*scale}px`;
                            heightIndicator.style.height = `${(topSlider.value - botSlider.value)*scale}px`;
                        };
                        updateHeight(null);
                        botSlider.addEventListener('change', updateHeight);
                        topSlider.addEventListener('change', updateHeight);
                    }
                }
            }
        });
    </script>
</body>
</html>
